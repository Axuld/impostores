<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Impostor â€” 3 jugadores (1 impostor)</title>
<style>
Â  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
Â  body{margin:0;background:#0b1020;color:#e6eef8;display:flex;min-height:100vh;align-items:center;justify-content:center;padding:18px;}
Â  .app{width:100%;max-width:920px;background:linear-gradient(180deg,#0f1626 0%, #0b1020 100%);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(2,6,23,.6);}
Â  h1{margin:0 0 8px 0;font-size:20px;text-align:center}
Â  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:12px}
Â  button{background:#162235;color:#e6eef8;border:0;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
Â  button.secondary{background:transparent;border:1px solid rgba(230,238,248,.08)}
Â  .panel{background:rgba(255,255,255,.02);padding:14px;border-radius:10px;margin-bottom:12px}
Â  .center{text-align:center}
Â  .card{background:#0b1626;padding:20px;border-radius:10px;min-height:120px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px}
Â  .role{font-weight:800;font-size:18px}
Â  .word{font-size:26px;font-weight:900;letter-spacing:.6px}
Â  .small{font-size:13px;color:#9fb0d0}
Â  .players-row{display:flex;gap:8px;justify-content:center;margin:12px 0}
Â  .player-box{background:rgba(255,255,255,.02);padding:10px;border-radius:8px;min-width:88px;text-align:center}
Â  .hidden{display:none}
Â  .vote-btn{width:100%;padding:10px;border-radius:8px;border:0;margin-top:6px}
Â  footer{font-size:12px;color:#8da0bf;text-align:center;margin-top:8px}
Â  .danger{background:#7b2e2e}
Â  .success{background:#1c6f3a}
Â  @media (max-width:520px){ .word{font-size:20px} }
</style>
</head>
<body>
<div class="app">
Â  <h1>Impostor â€” 3 jugadores (1 impostor)</h1>

Â  <div class="controls">
Â  Â  <button id="startRound">Iniciar nueva ronda</button>
Â  Â  <button id="resetUsed" class="secondary">Resetear palabras usadas</button>
Â  Â  <button id="showUsed" class="secondary">Ver # palabras usadas</button>
Â  Â  <div style="min-width:8px"></div>
Â  Â  <div class="small" id="statusText">Palabras disponibles: <span id="availableCount">0</span></div>
Â  </div>

Â  <div class="panel">
Â  Â  <div class="center small">Flujo: inicia ronda â†’ cada jugador mira su tarjeta (pÃ¡salo) â†’ votaciÃ³n â†’ resultado</div>
Â  </div>

Â  <div id="viewArea" class="panel">
Â  Â  <div id="turnView" class="card center">
Â  Â  Â  <div id="turnInstruction" class="small">Pulsa "Iniciar nueva ronda" para comenzar.</div>
Â  Â  Â  <div id="playerCard" class="hidden">
Â  Â  Â  Â  <div class="small">Jugador <span id="currentPlayer">1</span></div>
Â  Â  Â  Â  <div id="roleText" class="role"></div>
Â  Â  Â  Â  <div id="wordText" class="word"></div>
Â  Â  Â  Â  <div class="small">Pasa el dispositivo al siguiente jugador.</div>
Â  Â  Â  </div>
Â  Â  Â  <div style="margin-top:10px">
Â  Â  Â  Â  <button id="btnReveal" class="secondary hidden">Ver carta</button>
Â  Â  Â  Â  <button id="btnNextPlayer" class="hidden">Siguiente jugador</button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="voteSection" class="hidden" style="margin-top:12px">
Â  Â  Â  <div class="small center">DiscusiÃ³n terminada â€” Voten quiÃ©n creen que es el impostor</div>
Â  Â  Â  <div class="players-row" style="margin-top:8px">
Â  Â  Â  Â  <div class="player-box">Jugador 1 <div><button class="vote-btn" data-player="0">Votar 1</button></div></div>
Â  Â  Â  Â  <div class="player-box">Jugador 2 <div><button class="vote-btn" data-player="1">Votar 2</button></div></div>
Â  Â  Â  Â  <div class="player-box">Jugador 3 <div><button class="vote-btn" data-player="2">Votar 3</button></div></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="center small" style="margin-top:8px">Votos recogidos: <span id="votesCount">0</span>/3</div>
Â  Â  </div>

Â  Â  <div id="resultSection" class="hidden" style="margin-top:12px">
Â  Â  Â  <div class="card center">
Â  Â  Â  Â  <div id="resultTitle" class="role"></div>
Â  Â  Â  Â  <div class="small">Impostor real: Jugador <span id="realImpostor">?</span></div>
Â  Â  Â  Â  <div class="small">Palabras usadas esta ronda:</div>
Â  Â  Â  Â  <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;justify-content:center">
Â  Â  Â  Â  Â  <div class="player-box"><div class="small">Civiles</div><div id="wordCivil" class="word" style="font-size:18px"></div></div>
Â  Â  Â  Â  Â  <div class="player-box"><div class="small">Impostor</div><div id="wordImpostor" class="word" style="font-size:18px"></div></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="margin-top:12px">
Â  Â  Â  Â  Â  <button id="continueBtn">Continuar (siguiente ronda)</button>
Â  Â  Â  Â  Â  <button id="revealAllBtn" class="secondary">Revelar cartas ahora</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  </div>

Â  <div class="panel small">
Â  Â  <div><strong>Instrucciones (rÃ¡pido):</strong></div>
Â  Â  <ol>
Â  Â  Â  <li>Pulsa <em>Iniciar nueva ronda</em>. Se elegirÃ¡n 2 palabras nuevas (no repetidas).</li>
Â  Â  Â  <li>Pasa el dispositivo a cada jugador y que pulse <em>Ver carta</em> â€” mostrarÃ¡ su rol y palabra. DespuÃ©s <em>Siguiente jugador</em>.</li>
Â  Â  Â  <li>Cuando todos hayan visto su carta, voten (3 votos). Cuando se completen, se mostrarÃ¡ el resultado.</li>
Â  Â  Â  <li>Si quieres reiniciar la lista de palabras usadas, usa "Resetear palabras usadas".</li>
Â  Â  </ol>
Â  </div>

Â  <footer>Hecho con â¤ï¸ â€” Juego local sin servidores</footer>
</div>

<script>
/* ======================
Â  Â Lista LARGA de palabras
Â  Â Nota: ambas palabras usadas por ronda se marcarÃ¡n como 'usadas' y no volverÃ¡n a salir
Â  Â hasta que resetees con el botÃ³n.
Â  Â ====================== */
const WORDS = [
"manzana","naranja","plÃ¡tano","pera","uva","sandÃ­a","melÃ³n","cereza","fresa","kiwi","mango","piÃ±a","papaya","limÃ³n","lima",
"tomate","zanahoria","lechuga","espinaca","pollo","carne","pescado","huevo","leche","queso","yogur","pan","arroz","frijol",
"lenteja","maÃ­z","avena","cacao","azÃºcar","sal","pimienta","cafÃ©","tÃ©","miel","salsa","pizza","taco","arepa","hamburguesa",
"helado","pastel","galleta","chocolate","vainilla","menta","nuez","almendra","manÃ­","cacahuate","semilla","aceite","mantequilla",
"jarabe","jugo","vino","cerveza","vodka","ron","whisky","champÃº","jabÃ³n","cepillo","peine","esmalte","paÃ±al","toalla","almohada",
"colchÃ³n","silla","mesa","sofÃ¡","cortina","lÃ¡mpara","reloj","espejo","cuadro","flor","Ã¡rbol","hoja","raÃ­z","rama","bosque","playa",
"ocÃ©ano","rÃ­o","lago","montaÃ±a","valle","cueva","cueva","cielo","estrella","planeta","luna","sol","cometa","meteorito","nube",
"lluvia","nieve","granizo","viento","tormenta","truenos","relÃ¡mpago","arena","barro","piedra","roca","arena","hielo","fuego",
"ceniza","humedad","aire","atmÃ³sfera","volcÃ¡n","isla","penÃ­nsula","puerto","barco","aviÃ³n","tren","autobÃºs","bicicleta","moto",
"coche","camiÃ³n","taxi","semÃ¡foro","estaciÃ³n","mapa","ruta","camino","puente","carretera","edificio","casa","departamento","puerta",
"ventana","techo","pared","suelo","piso","escalera","ascensor","garaje","jardÃ­n","balcÃ³n","terraza","patio","cocina","baÃ±o","habitaciÃ³n",
"oficina","escuela","universidad","biblioteca","laboratorio","museo","teatro","cine","concierto","musica","canciÃ³n","guitarra","piano",
"baterÃ­a","violin","trompeta","saxofÃ³n","flauta","bajo","voz","artista","pintor","actor","directo","cineasta","novela","poema",
"historia","cuento","personaje","personaje","superhÃ©roe","villano","amigo","enemigo","familia","padre","madre","hermano","hermana",
"hijo","hija","abuelo","abuela","tÃ­o","tÃ­a","primo","prima","vecino","maestro","alumno","doctor","enfermera","policÃ­a","bombero",
"cientÃ­fico","ingeniero","programador","diseÃ±ador","chef","panadero","mecÃ¡nico","jardinero","relojero","carpintero","pescador",
"granjeros","campo","ciudad","pueblo","aldea","mercado","tienda","supermercado","restaurante","cafeterÃ­a","bar","hotel","hostal",
"playa","montaÃ±ismo","sendero","campamento","aventura","misterio","secreto","puente","llave","caja","tesoro","mapa","moneda",
"joya","anillo","collar","pulsera","medalla","trofeo","equipo","jugador","equipo","partido","gol","punto","victoria","derrota"
];

/* ======================
Â  Â Estado del juego
Â  Â ====================== */
let usedWords = new Set(JSON.parse(localStorage.getItem('impostor_used') || '[]'));
let availableWords = () => WORDS.filter(w => !usedWords.has(w));
const players = [null, null, null]; // cada Ã­ndice: {role: 'impostor'|'civil', word: '...'}
let impostorIndex = null;
let currentViewPlayer = 0; // 0..2
let revealedCount = 0;
let votes = [null, null, null]; // votos por jugador (Ã­ndice votado)
let votesCollected = 0;

/* UI refs */
const startBtn = document.getElementById('startRound');
const resetBtn = document.getElementById('resetUsed');
const showUsedBtn = document.getElementById('showUsed');
const availableCount = document.getElementById('availableCount');
const turnInstruction = document.getElementById('turnInstruction');
const btnReveal = document.getElementById('btnReveal');
const btnNextPlayer = document.getElementById('btnNextPlayer');
const playerCard = document.getElementById('playerCard');
const roleText = document.getElementById('roleText');
const wordText = document.getElementById('wordText');
const currentPlayerEl = document.getElementById('currentPlayer');
const voteSection = document.getElementById('voteSection');
const voteButtons = document.querySelectorAll('.vote-btn');
const votesCountEl = document.getElementById('votesCount');
const resultSection = document.getElementById('resultSection');
const resultTitle = document.getElementById('resultTitle');
const realImpostor = document.getElementById('realImpostor');
const wordCivil = document.getElementById('wordCivil');
const wordImpostor = document.getElementById('wordImpostor');
const btnContinue = document.getElementById('continueBtn');
const revealAllBtn = document.getElementById('revealAllBtn');

/* actualizar contador disponible */
function updateAvailable() {
Â  availableCount.textContent = availableWords().length;
}
updateAvailable();

/* utils */
function randomInt(max){ return Math.floor(Math.random()*max); }

/* iniciar ronda */
startBtn.addEventListener('click', ()=>{
Â  const avail = availableWords();
Â  if (avail.length < 2) {
Â  Â  if (avail.length === 1) alert('Solo queda 1 palabra libre. ResetÃ©alas o recarga para reiniciar.');
Â  Â  else alert('No quedan palabras disponibles. Presiona "Resetear palabras usadas" para reiniciar la lista.');
Â  Â  return;
Â  }
Â  // Elegir 2 palabras al azar (sin repetir)
Â  // Tomamos un shuffle sencillo sobre Ã­ndice
Â  const i1 = randomInt(avail.length);
Â  let i2 = randomInt(avail.length-1);
Â  if (i2 >= i1) i2 = i2+1;
Â  const wordA = avail[i1];
Â  const wordB = avail[i2];

Â  // Marcar usadas
Â  usedWords.add(wordA);
Â  usedWords.add(wordB);
Â  localStorage.setItem('impostor_used', JSON.stringify(Array.from(usedWords)));

Â  // Asignar roles: impostor diferente (1 impostor, 2 civiles)
Â  impostorIndex = randomInt(3);
Â  for(let i=0;i<3;i++){
Â  Â  if (i === impostorIndex) {
Â  Â  Â  players[i] = {role:'impostor', word: ""}; // <--- AQUÃ SE QUITA LA PALABRA DEL IMPOSTOR (SE DEJA STRING VACÃO)
Â  Â  } else {
Â  Â  Â  players[i] = {role:'civil', word: wordA};
Â  Â  }
Â  }

Â  // Reset view/votes
Â  currentViewPlayer = 0;
Â  revealedCount = 0;
Â  votes = [null,null,null];
Â  votesCollected = 0;
Â  votesCountEl.textContent = votesCollected;

Â  // UI: preparar para que el jugador 1 vea su carta
Â  playerCard.classList.add('hidden');
Â  document.getElementById('turnInstruction').textContent = 'PÃ¡salo al Jugador 1 y pulsa "Ver carta".';
Â  btnReveal.classList.remove('hidden');
Â  btnNextPlayer.classList.add('hidden');
Â  voteSection.classList.add('hidden');
Â  resultSection.classList.add('hidden');
Â  updateAvailable();
});

/* revelar carta del jugador actual */
btnReveal.addEventListener('click', ()=>{
Â  const p = players[currentViewPlayer];
Â  if (!p) return;
Â  // mostrar
Â  currentPlayerEl.textContent = currentViewPlayer+1;
Â  roleText.textContent = (p.role === 'impostor') ? 'IMPOSTOR' : 'Civil';
Â  wordText.textContent = p.word;
Â  // estilo para impostor/civil
Â  roleText.style.color = (p.role === 'impostor') ? '#ffb3b3' : '#cfe5ff';
Â  playerCard.classList.remove('hidden');
Â  btnReveal.classList.add('hidden');
Â  btnNextPlayer.classList.remove('hidden');
Â  // increment revealedCount solo cuando se pulsa "Siguiente jugador"
});

/* siguiente jugador despuÃ©s de ver la carta */
btnNextPlayer.addEventListener('click', ()=>{
Â  revealedCount++;
Â  currentViewPlayer++;
Â  if (revealedCount >= 3) {
Â  Â  // todos vieron - ir a votaciÃ³n
Â  Â  playerCard.classList.add('hidden');
Â  Â  btnReveal.classList.add('hidden');
Â  Â  btnNextPlayer.classList.add('hidden');
Â  Â  document.getElementById('turnInstruction').textContent = 'Todos vieron sus cartas. Pasen a votar.';
Â  Â  voteSection.classList.remove('hidden');
Â  } else {
Â  Â  // preparar vista para siguiente jugador
Â  Â  playerCard.classList.add('hidden');
Â  Â  btnReveal.classList.remove('hidden');
Â  Â  btnNextPlayer.classList.add('hidden');
Â  Â  document.getElementById('turnInstruction').textContent = 'PÃ¡salo al Jugador ' + (currentViewPlayer+1) + ' y pulsa "Ver carta".';
Â  }
});

/* votaciÃ³n */
voteButtons.forEach(btn=>{
Â  btn.addEventListener('click', ()=>{
Â  Â  const voter = votesCollected; // simple: recogemos votos en orden (0..2)
Â  Â  const votedIndex = parseInt(btn.dataset.player,10);
Â  Â  // evitar doble votar por el mismo votante
Â  Â  // buscamos primer slot null para asignar el voto
Â  Â  let slot = votes.findIndex(v=>v===null);
Â  Â  if (slot === -1) {
Â  Â  Â  alert('Ya se recogieron los 3 votos.');
Â  Â  Â  return;
Â  Â  }
Â  Â  votes[slot] = votedIndex;
Â  Â  votesCollected++;
Â  Â  votesCountEl.textContent = votesCollected;
Â  Â  // desactivar el botÃ³n pulsado brevemente para que no lo repitan
Â  Â  btn.disabled = true;
Â  Â  // cuando se recojan 3 votos, resolver
Â  Â  if (votesCollected >= 3) {
Â  Â  Â  resolveRound();
Â  Â  }
Â  });
});

/* resolver la ronda tras la votaciÃ³n */
function resolveRound(){
Â  voteSection.classList.add('hidden');
Â  resultSection.classList.remove('hidden');

Â  // Tally: cuÃ¡l fue el jugador con mÃ¡s votos (simple mayorÃ­a)
Â  const tally = {};
Â  votes.forEach(v=>{
Â  Â  tally[v] = (tally[v]||0) + 1;
Â  });
Â  // escoger el con mÃ¡s votos, en empate el mÃ¡s pequeÃ±o Ã­ndice
Â  let top = null, topCount = -1;
Â  Object.keys(tally).forEach(k=>{
Â  Â  const c = tally[k];
Â  Â  if (c > topCount){ top = Number(k); topCount = c; }
Â  Â  else if (c === topCount && Number(k) < top) top = Number(k);
Â  });

Â  // determinar ganador
Â  const impostor = impostorIndex;
Â  if (top === impostor) {
Â  Â  resultTitle.textContent = 'Â¡Los civiles ganan! ğŸ‰';
Â  Â  resultTitle.style.color = '#b8f0bb';
Â  } else {
Â  Â  resultTitle.textContent = 'Â¡El impostor gana! ğŸ•µï¸â€â™‚ï¸';
Â  Â  resultTitle.style.color = '#ffb3b3';
Â  }
Â  realImpostor.textContent = (impostor+1);
Â  // mostrar palabras
Â  const civilWord = players.find(p=>p.role==='civil').word;
Â  // En el original era 'wordB', pero ahora wordB no estÃ¡ disponible directamente.
Â  // Buscamos la palabra original del impostor antes de modificarla:
Â  // Para obtener la palabra que *debÃ­a* tener el impostor (wordB) para mostrarla al final,
Â  // necesitamos modificar la lÃ³gica de asignaciÃ³n/guardado.
Â  // Si no modificamos el inicio de la ronda para guardar wordB, buscamos la palabra
Â  // que NO es la de los civiles entre las usadas:
Â  const usedArr = Array.from(usedWords);
Â  const impWord = usedArr.find(w => w !== civilWord);
Â  wordCivil.textContent = civilWord;
Â  wordImpostor.textContent = impWord; // Muestra la palabra real del impostor para el resultado
}

/* continuar a siguiente ronda (simplemente oculta resultados; no crea nueva ronda hasta pulsar start) */
btnContinue.addEventListener('click', ()=>{
Â  resultSection.classList.add('hidden');
Â  document.getElementById('turnInstruction').textContent = 'Pulsa "Iniciar nueva ronda" para otra ronda.';
Â  updateAvailable();
});

/* revelar todas las cartas (por si quieren ver ahora) */
revealAllBtn.addEventListener('click', ()=>{
Â  // mostrar en resultado las cartas (ya se muestra)
Â  alert('Se han revelado las palabras en la secciÃ³n de resultados.');
});

/* resetear palabras usadas */
resetBtn.addEventListener('click', ()=>{
Â  if (!confirm('Â¿Seguro quieres resetear la lista de palabras usadas? Esto permitirÃ¡ que las palabras vuelvan a salir.')) return;
Â  usedWords = new Set();
Â  localStorage.removeItem('impostor_used');
Â  alert('Lista reseteada. Puedes iniciar nuevas rondas con todas las palabras disponibles.');
Â  updateAvailable();
});

/* mostrar cantidad de usadas (info rÃ¡pida) */
showUsedBtn.addEventListener('click', ()=>{
Â  alert('Palabras usadas hasta ahora: ' + Array.from(usedWords).join(', '));
});

/* al cargar, actualizar contador y deshabilitar vote buttons si no hay ronda */
updateAvailable();

/* protecciÃ³n mÃ­nima: si recargas estando en mitad de proceso, limpiamos estados que no aplican */
window.addEventListener('load', ()=>{
Â  // NO hacemos auto-start; solo actualizamos disponibles
Â  updateAvailable();
});
</script>
</body>
</html>
